import{b as j,e as N,r,A as k,u as O,j as t}from"./index-D4ATXNzv.js";import{l as S}from"./index-Rnf9BJUB.js";import{C as m,a as R}from"./index.esm-iiesrihq.js";const D="http://localhost:5000",B=()=>{const{roomCode:l}=j(),[v]=N(),{user:g}=r.useContext(k),d=O(),[u,f]=r.useState(l||""),[s,p]=r.useState(new m),[n,h]=r.useState(v.get("playerColor")||""),[C,a]=r.useState(""),[c,b]=r.useState(null);r.useEffect(()=>{console.log("Game instance:",s),console.log("game.isGameOver():",s.isGameOver())},[s]),r.useEffect(()=>{if(!n||!s||typeof s.isGameOver!="function")return;let o="";s.isGameOver()?s.isCheckmate()?o=s.turn()===n[0]?"You lost by checkmate.":"You won by checkmate!":s.isStalemate()?o="Draw by stalemate.":s.isInsufficientMaterial()?o="Draw by insufficient material.":o="Game over.":o=s.turn()===n[0]?"Your turn.":"Opponent's turn.",console.log("Status message updated:",o),a(o)},[s,n]),r.useEffect(()=>{console.log("Creating socket connection...");const o=S(D,{query:{gameType:"chess",userId:g?g._id:null}});return b(o),l?(console.log("Joining existing room:",l),o.emit("joinChessRoom",{roomCode:l}),f(l)):(console.log("Creating new room..."),o.emit("createChessRoom")),o.on("roomCreated",e=>{console.log("ROOM CREATED event received:",e),f(e.roomCode),h(e.color)}),o.on("assignColor",e=>{console.log("ASSIGN COLOR event received:",e),h(e.color)}),o.on("botGameStarted",e=>{console.log("botGameStarted event received:",e),e&&e.roomCode&&(f(e.roomCode),h(e.color),a(`Bot game started in room: ${e.roomCode}`),setTimeout(()=>{d(`/game/chess/room/${e.roomCode}?botGame=true&playerColor=${e.color}`)},2e3))}),o.on("chessMove",e=>{console.log("chessMove event received:",e),e&&e.fen&&(console.log("Updating board with new FEN:",e.fen),p(new m(e.fen)))}),o.on("startGame",e=>{console.log("startGame event received:",e),e&&e.roomCode&&a("Game started!")}),o.on("errorMessage",e=>{console.log("errorMessage event received:",e),a(e.message||"An error occurred.")}),o.on("resetGame",()=>{console.log("resetGame event received"),p(new m),a("Game has been reset.")}),o.on("playerDisconnected",e=>{console.log("playerDisconnected event received:",e),a(e.message||"Opponent disconnected.")}),()=>{console.log("Disconnecting socket..."),o.disconnect()}},[g,l,d]);const x=(o,e)=>{if(console.log(`onDrop called: ${o} -> ${e}`),console.log("Current game instance:",s),console.log("Type of game.isGameOver:",typeof s.isGameOver),!s||typeof s.isGameOver!="function")return console.log("Game not ready"),!1;if(s.turn()!==n[0])return console.log("Not your turn. Game turn:",s.turn(),"Player color:",n),!1;const i=new m(s.fen()).move({from:o,to:e,promotion:"q"});return i===null?(console.log("Invalid move attempted:",o,"to",e),!1):(console.log("Valid move detected:",i.san),c?(console.log("Emitting move to server:",i.san),c.emit("chessMove",{roomCode:u,move:i.san})):console.log("Socket not available"),!0)},y=o=>{console.log("Attempting to drag piece:",o);const e=o[0]===n[0].toLowerCase();return console.log("onPieceDragStart allowed?",e),e},G=()=>{console.log("Reset button clicked"),c&&c.emit("resetChessGame",{roomCode:u})},w=()=>{c&&(console.log("Requesting to start bot game"),c.emit("startBotGame"))};return t.jsxs("div",{className:"h-screen w-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white flex flex-col",children:[t.jsxs("header",{className:"flex flex-col items-center justify-center p-4 bg-gray-800 shadow-md",children:[t.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Chess Game"}),t.jsxs("p",{className:"text-lg",children:["Room Code: ",t.jsx("span",{className:"font-semibold",children:u})]}),n&&t.jsxs("p",{className:"text-lg",children:["You are playing as ",t.jsx("span",{className:"font-semibold",children:n})]}),t.jsx("p",{className:"mt-2 text-md",children:C})]}),t.jsx("main",{className:"h-full w-full flex-grow flex items-center justify-center",children:t.jsx(R,{position:s.fen(),onPieceDrop:x,onPieceDragStart:y,boardOrientation:n||"white",boardWidth:Math.min(window.innerWidth,window.innerHeight)*.8})}),t.jsxs("footer",{className:"p-4 flex justify-center space-x-4 bg-gray-800",children:[t.jsx("button",{onClick:w,className:"px-4 py-2 bg-green-600 rounded hover:bg-green-700 transition font-semibold",children:"Play with Bot"}),t.jsx("button",{onClick:G,className:"px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 transition font-semibold",children:"Reset Game"}),t.jsx("button",{onClick:()=>d(-1),className:"px-4 py-2 bg-gray-600 rounded hover:bg-gray-500 transition font-semibold",children:"Back"})]})]})};export{B as default};
