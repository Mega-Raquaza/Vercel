import{b as S,r as i,A as B,j as e,a as n}from"./index-D4ATXNzv.js";const c="http://localhost:5000",q=()=>{const{queryId:a}=S(),{user:l}=i.useContext(B),[r,x]=i.useState(null),[m,h]=i.useState(""),[u,g]=i.useState({}),[b,d]=i.useState({}),[y,j]=i.useState(!0),[p,f]=i.useState("");i.useEffect(()=>{(async()=>{try{const t=await n.get(`${c}/api/queries/${a}`);x(t.data)}catch(t){console.error(t),f("Error fetching query details")}finally{j(!1)}})()},[a]);const o=async()=>{try{const s=await n.get(`${c}/api/queries/${a}`);x(s.data)}catch(s){console.error(s)}},N=async s=>{if(s.preventDefault(),!l){alert("You must be logged in to answer.");return}try{await n.post(`${c}/api/queries/${a}/answer`,{answer:m},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},withCredentials:!0}),h(""),o()}catch(t){console.error(t),f("Error submitting answer")}},w=async s=>{if(!l){alert("You must be logged in to reply.");return}try{await n.post(`${c}/api/queries/${a}/answer/${s}/reply`,{reply:u[s]},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},withCredentials:!0}),g(t=>({...t,[s]:""})),d(t=>({...t,[s]:!1})),o()}catch(t){console.error(t)}},v=async s=>{try{await n.post(`${c}/api/queries/${a}/finalAnswer`,{answerId:s},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},withCredentials:!0}),o()}catch(t){console.error(t)}},A=async()=>{try{await n.post(`${c}/api/queries/${a}/upvote`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},withCredentials:!0}),o()}catch(s){console.error(s)}},k=async s=>{try{await n.post(`${c}/api/queries/${a}/answer/${s}/like`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},withCredentials:!0}),o()}catch(t){console.error(t)}},$=async s=>{try{await n.post(`${c}/api/queries/${a}/answer/${s}/dislike`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},withCredentials:!0}),o()}catch(t){console.error(t)}};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center text-white",children:"Loading..."}):p?e.jsx("div",{className:"min-h-screen flex items-center justify-center text-red-500",children:p}):r?(r.finalAnswer&&r.answers.find(s=>s._id===r.finalAnswer),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 p-8 rounded-2xl border border-gray-700 shadow-xl mb-8",children:[e.jsx("h1",{className:"text-4xl font-extrabold text-white mb-6",children:r.title}),r.image&&e.jsx("img",{src:r.image,alt:"Query",className:"mb-6 rounded-xl max-h-72 object-cover w-full"}),e.jsx("p",{className:"text-gray-300 text-lg mb-4",children:r.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("span",{className:"text-gray-400",children:[e.jsx("strong",{children:"Subject:"})," ",r.subject]}),e.jsxs("span",{className:"text-gray-400",children:[e.jsx("strong",{children:"Asked by:"})," ",r.username]})]}),!r.finalAnswer&&e.jsx("div",{className:"flex space-x-4 mt-6",children:e.jsxs("button",{onClick:A,className:"flex items-center px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow hover:bg-green-500 transition",children:[e.jsx("i",{className:"fas fa-thumbs-up mr-2"}),"Upvote (",r.upvotes?r.upvotes.length:0,")"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Answers"}),e.jsx("div",{className:"space-y-4",children:r.answers&&r.answers.length>0?r.answers.map(s=>e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:s.answeredBy?s.answeredBy.charAt(0).toUpperCase():"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white",children:s.text}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:s.answeredBy}),!r.finalAnswer&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>k(s._id),className:"text-green-400 hover:text-green-300 text-sm flex items-center",children:[e.jsx("i",{className:"fas fa-thumbs-up mr-1"}),s.likes?s.likes.length:0]}),e.jsxs("button",{onClick:()=>$(s._id),className:"text-red-400 hover:text-red-300 text-sm flex items-center",children:[e.jsx("i",{className:"fas fa-thumbs-down mr-1"}),s.dislikes?s.dislikes.length:0]}),l&&r.askedBy===l._id&&!r.finalAnswer&&e.jsxs("button",{onClick:()=>v(s._id),className:"text-blue-400 hover:text-blue-300 text-sm flex items-center",children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Mark as Final"]})]})]})]})]}),e.jsxs("div",{className:"mt-4 ml-12",children:[s.replies&&s.replies.length>0?s.replies.map(t=>e.jsxs("div",{className:"flex items-start space-x-3 bg-gray-700 p-2 rounded mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:t.repliedBy?t.repliedBy.charAt(0).toUpperCase():"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:t.text}),e.jsx("span",{className:"text-gray-400 text-xs",children:t.repliedBy})]})]},t._id)):e.jsx("p",{className:"text-gray-400 text-sm",children:"No replies yet."}),!r.finalAnswer&&(b[s._id]?e.jsxs("div",{className:"mt-2 ml-2",children:[e.jsx("textarea",{value:u[s._id]||"",onChange:t=>g(C=>({...C,[s._id]:t.target.value})),placeholder:"Write your reply...",className:"w-full p-2 bg-gray-700 border border-gray-600 rounded text-white text-sm mb-2 focus:ring-2 focus:ring-purple-500",rows:"2"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>w(s._id),className:"px-3 py-1 bg-blue-600 rounded text-sm hover:bg-blue-500 transition",children:"Submit"}),e.jsx("button",{onClick:()=>d(t=>({...t,[s._id]:!1})),className:"px-3 py-1 bg-gray-600 rounded text-sm hover:bg-gray-500 transition",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>d(t=>({...t,[s._id]:!0})),className:"mt-2 text-blue-400 hover:text-blue-300 text-sm",children:"Reply"}))]})]},s._id)):e.jsx("p",{className:"text-gray-400",children:"No answers yet. Be the first to answer!"})})]}),l&&!r.finalAnswer&&l._id!==r.askedBy&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Submit Your Answer"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:l.username?l.username.charAt(0).toUpperCase():"U"})}),e.jsxs("form",{onSubmit:N,className:"flex-1 bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("textarea",{value:m,onChange:s=>h(s.target.value),placeholder:"Write your answer here...",required:!0,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-2",rows:"3"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 rounded hover:bg-blue-500 transition-colors text-sm",children:"Submit Answer"})]})]})]}),r.finalAnswer&&e.jsx("div",{className:"mt-8 text-blue-400 font-bold text-center",children:"Final answer has been selected. No further answers allowed."})]})):e.jsx("div",{className:"min-h-screen flex items-center justify-center text-white",children:"No query found."})};export{q as default};
