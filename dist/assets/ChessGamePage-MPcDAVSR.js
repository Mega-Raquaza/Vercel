import{b as j,r,A as w,u as N,j as o}from"./index-D4ATXNzv.js";import{l as v}from"./index-Rnf9BJUB.js";import{C as m,a as k}from"./index.esm-iiesrihq.js";const G="http://localhost:5000",M=()=>{const{roomCode:h}=j(),{user:i}=r.useContext(w),g=N(),[a,x]=r.useState(h||""),[t,u]=r.useState(new m),[n,d]=r.useState(""),[p,l]=r.useState(""),[c,b]=r.useState(null);r.useEffect(()=>{if(!n)return;let s="";t.game_over()?t.in_checkmate()?s=t.turn()===n[0]?"You lost by checkmate.":"You won by checkmate!":t.in_stalemate()?s="Draw by stalemate.":t.insufficient_material()?s="Draw by insufficient material.":s="Game over.":s=t.turn()===n[0]?"Your turn.":"Opponent's turn.",l(s)},[t,n]),r.useEffect(()=>{const s=v(G,{query:{gameType:"chess",userId:i?i._id:null}});return b(s),a?s.emit("joinChessRoom",{roomCode:a}):s.emit("createChessRoom"),s.on("roomCreated",e=>{console.log("Room created:",e.roomCode,"Assigned color:",e.color),x(e.roomCode),d(e.color)}),s.on("assignColor",e=>{console.log("Assigned color:",e.color),d(e.color)}),s.on("chessMove",e=>{e&&e.fen&&(console.log("Received updated FEN:",e.fen),u(new m(e.fen)))}),s.on("startGame",e=>{e&&e.roomCode&&l("Game started!")}),s.on("errorMessage",e=>{l(e.message||"An error occurred.")}),s.on("resetGame",e=>{u(new m),l("Game has been reset.")}),s.on("playerDisconnected",e=>{l(e.message||"Opponent disconnected.")}),()=>{s.disconnect(),console.log("Disconnected from chess game room")}},[a,i]);const C=(s,e)=>{if(t.turn()!==n[0])return console.log("Not your turn"),!1;const f=t.move({from:s,to:e,promotion:"q"});return f===null?!1:(c&&c.emit("chessMove",{roomCode:a,move:f.san}),!0)},y=()=>{c&&c.emit("resetChessGame",{roomCode:a})};return o.jsxs("div",{className:"h-screen w-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white flex flex-col",children:[o.jsxs("header",{className:"flex flex-col items-center justify-center p-4 bg-gray-800 shadow-md",children:[o.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Chess Game"}),o.jsxs("p",{className:"text-lg",children:["Room Code: ",o.jsx("span",{className:"font-semibold",children:a})]}),n&&o.jsxs("p",{className:"text-lg",children:["You are playing as ",o.jsx("span",{className:"font-semibold",children:n})]}),o.jsx("p",{className:"mt-2 text-md",children:p})]}),o.jsx("main",{className:"h-full w-full flex-grow flex items-center justify-center",children:o.jsx(k,{position:t.fen(),onPieceDrop:C,boardOrientation:n||"white",boardWidth:Math.min(window.innerWidth,window.innerHeight)*.8})}),o.jsxs("footer",{className:"p-4 flex justify-center space-x-4 bg-gray-800",children:[o.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 transition font-semibold",children:"Reset Game"}),o.jsx("button",{onClick:()=>g(-1),className:"px-4 py-2 bg-gray-600 rounded hover:bg-gray-500 transition font-semibold",children:"Back"})]})]})};export{M as default};
